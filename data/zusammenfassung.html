<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zusammenfassung</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>

<body>

    <div class="container">
        <h1>Zusammenfassung</h1>
        <p style="text-align: center; font-size: 1.2rem; color: #6c757d; margin-top: -1rem; margin-bottom: 2rem;">
            Messung <b>{{MEASUREMENT_ID}}</b></p>

        <div class="info-grid">
            <div class="info-item">
                <span class="label">Gestartet</span>
                <p>{{START_DATE}}, {{START_TIME}}</p>
            </div>
            <div class="info-item">
                <span class="label">Beendet</span>
                <p>{{STOP_DATE}}, {{STOP_TIME}}</p>
            </div>
            <div class="info-item">
                <span class="label">Gesamtdauer</span>
                <p>{{DURATION}}</p>
            </div>
            <div class="info-item">
                <span class="label">Teigtemperatur Start</span>
                <p>{{PROBE_TEMP}} °C</p>
            </div>
        </div>

        <h2>Teigzusammensetzung</h2>
        <table>
            <thead>
                <tr>
                    <th>Zutat</th>
                    <th>Menge</th>
                    <th>Anteil</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Mehl</td>
                    <td><span id="mehl">{{MEHL_MENGE}}</span> g</td>
                    <td>100 %</td>
                </tr>
                <tr>
                    <td>Wasser</td>
                    <td><span id="wasser">{{WASSER_MENGE}}</span> g</td>
                    <td><span id="wasser_anteil">---</span> %</td>
                </tr>
                <tr>
                    <td>Starter</td>
                    <td><span id="starter">{{STARTER_MENGE}}</span> g</td>
                    <td><span id="starter_anteil">---</span> %</td>
                </tr>
                <tr>
                    <td>Salz</td>
                    <td><span id="salz">{{SALZ_MENGE}}</span> g</td>
                    <td><span id="salz_anteil">---</span> %</td>
                </tr>
                <tr style="font-weight: bold;">
                    <td>Gesamtteig</td>
                    <td><span id="gesamt">---</span> g</td>
                    <td></td>
                </tr>
                <tr>
                    <td>Probenmenge</td>
                    <td>{{PROBE_MENGE}} g</td>
                    <td></td>
                </tr>
            </tbody>
        </table>

        <h2>PH-Wert Verlauf</h2>
        <table>
            <thead>
                <tr>
                    <th>Uhrzeit</th>
                    <th>PH-Wert</th>
                </tr>
            </thead>
            <tbody id="ph_table_body">
                <tr>
                    <td colspan="2" style="text-align: center; color: #6c757d;">Keine PH-Werte erfasst</td>
                </tr>
            </tbody>
        </table>

        <h2>Notizen</h2>
        <p class="notes">{{NOTIZEN}}</p>

        <form action="/" method="post" style="text-align: center; margin-top: 2rem;">
            <button class="button" type="submit" name="action" value="new">Neue Messung starten</button>
        </form>
    </div>

    <!-- PH-Daten als JSON -->
    <script id="ph_data" type="application/json">
        {{PH_DATA_JSON}}
    </script>

    <script>
        // Berechne Anteile basierend auf Mehlmenge (100%) und Gesamtmenge
        window.addEventListener('DOMContentLoaded', function () {
            const mehl = parseFloat(document.getElementById('mehl').textContent);
            const wasser = parseFloat(document.getElementById('wasser').textContent);
            const starter = parseFloat(document.getElementById('starter').textContent);
            const salz = parseFloat(document.getElementById('salz').textContent);

            if (mehl > 0) {
                // Berechne Anteile
                const wasserAnteil = (wasser / mehl * 100).toFixed(1);
                const starterAnteil = (starter / mehl * 100).toFixed(1);
                const salzAnteil = (salz / mehl * 100).toFixed(1);

                document.getElementById('wasser_anteil').textContent = wasserAnteil;
                document.getElementById('starter_anteil').textContent = starterAnteil;
                document.getElementById('salz_anteil').textContent = salzAnteil;

                // Berechne Gesamtmenge
                const gesamtMenge = (mehl + wasser + starter + salz).toFixed(1);
                document.getElementById('gesamt').textContent = gesamtMenge;
            }

            // PH-Wert Tabelle füllen
            try {
                const phDataElement = document.getElementById('ph_data');
                const phData = JSON.parse(phDataElement.textContent);
                const tbody = document.getElementById('ph_table_body');

                if (phData && phData.length > 0) {
                    // Leere die Tabelle
                    tbody.innerHTML = '';

                    // Füge jede PH-Messung hinzu
                    phData.forEach(function (entry) {
                        const row = tbody.insertRow();
                        const cellTime = row.insertCell(0);
                        const cellValue = row.insertCell(1);

                        cellTime.textContent = entry.time;
                        cellValue.textContent = entry.value.toFixed(2);
                    });
                }
            } catch (e) {
                console.error('Fehler beim Laden der PH-Daten:', e);
            }
        });
    </script>

</body>

</html>